<html  xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>登录界面</title>
    <link th:href="@{/statics/css/default.css}" rel="stylesheet" type="text/css" />
    <!--必要样式-->
    <link th:href="@{/statics/css/styles.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/statics/css/demo.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/statics/css/loaders.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/statics/layui/css/layui.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{/statics/layui/css/modules/layer/default/layer.css}" rel="stylesheet" type="text/css" />
    <script th:src="@{/statics/js/jquery-3.3.1.js}" type="text/javascript"></script>
    <script th:src="@{/statics/js/jquery-ui.min.js}" type="text/javascript"></script>
    <script th:src='@{/statics/js/stopExecutionOnTimeout.js?t=1}' type="text/javascript"></script>
    <script th:src="@{/statics/layui/layui.js}" type="text/javascript"></script>
    <script th:src="@{/statics/layer/layer.js}" type="text/javascript"></script>
    <script th:src="@{/statics/js/Particleground.js}" type="text/javascript"></script>
    <script th:src="@{/statics/js/Treatment.js}" type="text/javascript"></script>
    <script th:src="@{/statics/js/jquery.mockjax.js}" type="text/javascript"></script>
</head>
<body>
<form class='login'>
    <div class='login_title'>
        <span>管理员登录</span>
    </div>
    <div class='login_fields'>
        <div class='login_fields__user'>
            <div class='icon'>
                <img alt="" th:src='@{/statics/img/user_icon_copy.png}'>
            </div>
            <input name="username" placeholder='用户名' maxlength="16" type='text' autocomplete="off" value="" lay-verify="username"/>
            <div class='validation'>
                <img alt="" th:src='@{/statics/img/tick.png}'>
            </div>
        </div>
        <div class='login_fields__password'>
            <div class='icon'>
                <img alt="" th:src='@{/statics/img/lock_icon_copy.png}'>
            </div>
            <input name="password" placeholder='密码' maxlength="16" type='text' autocomplete="off" value="" lay-verify="password">
            <div class='validation'>
                <img alt="" th:src='@{/statics/img/tick.png}'>
            </div>
        </div>
        <div class='login_fields__password'>
            <div class='icon'>
                <img alt="" th:src='@{/statics/img/key.png}'>
            </div>
            <input name="captchaCode" placeholder='验证码' maxlength="4" type='text' autocomplete="off" lay-verify="code">
            <img type="image" src="../captcha/kaptcha.jpg" id="codeImage" onclick="chageCode()" title="图片看不清？点击重新得到验证码" style="cursor:pointer;" width="116" height="36"/><br>
        </div>
        <div class='login_fields__submit'>
            <input type='button' value='登录' >
            <span style="margin-left: 13%;">记住我</span>
            <input type="checkbox" name="rememberMe" />
        </div>
    </div>
    <div class='success'>
    </div>
    <div class='disclaimer'>
        <p>欢迎登陆后台管理系统</p>
    </div>
</form>
</body>
<script type="text/javascript" th:inline="javascript">
    const context = [[${#httpServletRequest.getContextPath()}]];
    var canGetCookie = 0;//是否支持存储Cookie 0 不支持 1 支持
    var ajaxmockjax = 1;//是否启用虚拟Ajax的请求响 0 不启用  1 启用
    var CodeVal = 0;
    function chageCode(){
        document.getElementById("codeImage").src="../captcha/kaptcha.jpg?"+Math.random();
    }

    //粒子背景特效
    $('body').particleground({
        dotColor: '#E8DFE8',
        lineColor: '#133b88'
    });
    $('input[name="password"]').focus(function () {
        $(this).attr('type', 'password');
    });
    $('input[type="password"]').focus(function () {
        $(this).prev().animate({ 'opacity': '1' }, 200);
    });
    $('input[type="captchaCode"],input[type="password"]').blur(function () {
        $(this).prev().animate({ 'opacity': '.5' }, 200);
    });
    $('input[name="username"],input[name="password"]').keyup(function () {
        var Len = $(this).val().length;
        if (!$(this).val() == '' && Len >= 5) {
            $(this).next().animate({
                'opacity': '1',
                'right': '30'
            }, 200);
        } else {
            $(this).next().animate({
                'opacity': '0',
                'right': '20'
            }, 200);
        }
    });

    layui.use(['jquery'], function() {
        var layer = layui.layer
            , $ = layui.jquery;

        $("input[type='button']").click(function(){
            var username = $("input[name='username']").val();
            var password = $("input[name='password']").val();
            var captchaCode = $("input[name='captchaCode']").val();
            var rememberMe = $("input[name='rememberMe']").is(':checked') ? 1 : 0;
            var sub_data = {'username':username, 'password': password, "captchaCode":captchaCode, "rememberMe": rememberMe};
            $.post(context+"/login/check", sub_data, function(res) {
                console.log(res);
                if (res.code == 100) {
                    layer.msg('<p style=\"color: #000\">' + '登录成功' + '</p>', {
                        icon: 1,
                        time: 1 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        location.href = context + '/work/index';
                    });
                }else if(res.extend.msg=="验证码错误！AA"){
                    layer.msg('<p style=\"color: #000\">'+ '验证码错误' + '</p>', {
                        icon: 2,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {

                    });
                } else if(res.code == 200){
                    layer.msg('<p style=\"color: #000\">'+ '账号或密码错误' + '</p>', {
                        icon: 2,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {

                    });
                }
            })
        });

    })


</script>
</html>