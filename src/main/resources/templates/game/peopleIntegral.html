<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="common/header::copy"></head>
<style>
    .ws-icon {
        width: 40px;
        height: 40px;
        margin-left: 10px;
    }
</style>
<body class="layui-layout-body">
<div>
    <img th:src="@{/statics/images/daochu.png}" class="ws-icon" id="ICNO"/>
</div>
<div>
    <table class="layui-hide" id="Finshs" lay-filter="demo"></table>
</div>
<script th:replace="common/script::copy"></script>
<script type="text/javascript" th:inline="javascript">
    layui.use('table', function () {
        var table = layui.table
            , $ = layui.$
            , form = layui.form;
        table.render({
            elem: '#Finshs'
            , url: context + '/game/findPeopleIntegral?gafeId=' + [[${gafeId}]]
            , cellMinWidth: 80
            , cols: [[
                {field: 'gameId', title: '游戏编号', sort: true}
                , {field: 'gafeId', title: '场次编号'}
                , {field: 'uName', title: '用户姓名'}
                , {field: 'cardName', title: '打卡名称'}
                , {field: 'uUrl', title: '图片', align: 'center', templet: '#imgTpl', event: 'browse'}
                , {field: 'peinIntegral', title: '用户积分'}//
            ]]
            , page: true
            , done: function (res, curr, count) {
                hoverOpenImg();//显示大图
            }
        });
        $("#ICNO").click(function () {
            var gafeId=[[${gafeId}]];
            var integral=[[${integral}]];
            $.post(context + "/game/ExcelByPeople", {
                "gafeId": gafeId,
                "integral":integral
            }, function (res) {
                console.log(res);
                if(res.extend.message==="成功"){
                    window.location.href=context+"/game/ExcelPeople?gafeId="+gafeId+"&integral="+integral;
                }else{
                    layer.alert(res.extend.message);
                }
            })

        });

        function hoverOpenImg() {
            var img_show = null; // tips提示
            $('td img').hover(function () {
                var img = "<img class='img_msg' src='" + $(this).attr('src') + "' style='width:130px;' />";
                img_show = layer.tips(img, this, {
                    tips: [2, 'rgba(41,41,41,.5)']
                    , area: ['160px']
                });
            }, function () {
                layer.close(img_show);
            });
            $('td img').attr('style', 'max-width:70px');
        }
    });
</script>
<script type="text/html" id="imgTpl">
    <img src="{{ d.uUrl}}"/>
</script>
</body>
</html>