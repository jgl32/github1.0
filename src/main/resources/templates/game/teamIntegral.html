<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="common/header::copy"></head>
<style>
    .ws-icon {
        width: 40px;
        height: 40px;
        margin-left: 10px;
    }
</style>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-body">
        <!-- 内容主体区域 -->
        <div style="padding: 15px;">
            <hr class="layui-bg-orange">
            <div style="padding: 20px; background-color: #F2F2F2;">
                <div class="layui-row layui-col-space15">
                    <div class="layui-col-md12">
                        <div class="layui-card">
                            <div class="layui-card-header">
                                <button type="button" id="gameApply" class="layui-btn layui-btn-radius layui-btn-normal">
                                    返回上一页
                                </button>
                                    <img th:src="@{/statics/images/daochu.png}" class="ws-icon" id="ICNO"/>
                            </div>
                            <div class="layui-card-body">
                                <table class="layui-hide" id="Finshs" lay-filter="demo1"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:replace="common/script::copy"></script>
<script type="text/javascript" th:inline="javascript">
    layui.use(['table', 'jquery', 'form'], function () {
        var table = layui.table
            , form = layui.form
            , $ = layui.jquery;

        table.render({
            elem: '#Finshs'
            , url: context + '/game/findTeamIntegral?gafeId='+[[${gafeId}]]
            , cellMinWidth: 80
            , cols: [[
                {field: 'gameId', title: '游戏编号'}
                , {field: 'gafeId', title: '场次编号'}
                , {field: 'teamId', title: '团队编号'}
                , {field: 'teamName', title: '团队名称'}
                , {field: 'teamManifesto', title: '团队描述'}
                , {field: 'integral', title: '团队积分'}
                , { field: 'teamBadge', title: '团队徽章', align: 'center',templet: '#imgTpl',event: 'browse' }
                , {title: '操作', toolbar: '#barDemo', align: 'center'}//
            ]]
            , page: true
            ,done: function (res, curr, count) {
                hoverOpenImg();//显示大图
            }
        });
        $("#ICNO").click(function () {
            var gafeId=[[${gafeId}]];
            var integral=[[${integral}]];
            $.post(context + "/game/ExcelByTeam", {
                "gafeId": gafeId,
                "integral":integral
            }, function (res) {
                if(res.extend.message==="成功"){
                    window.location.href=context+"/game/ExcelTeam?gafeId="+gafeId+"&integral="+integral;
                }else{
                    layer.alert(res.extend.message);
                }
            })

        });
        table.on('tool(demo1)', function (obj) {
            var data = obj.data;

            if (obj.event === "people") {
                console.log(data.teamId);
                layer.open({
                    type: 2,
                    title: '查看个人积分',
                    area: ['850px', '600px'],
                    shadeClose: true,
                    content: context + "/game/detailsTeam?teamId="+data.teamId,
                    end: function () {
                    }
                });
            }
        });
        $("#gameApply").click(function () {
            window.location.href=context+"/game/gameIntegral";
        });
        function hoverOpenImg() {
            var img_show = null; // tips提示
            $('td img').hover(function () {
                var img = "<img class='img_msg' src='" + $(this).attr('src') + "' style='width:130px;' />";
                img_show = layer.tips(img, this, {
                    tips: [2, 'rgba(41,41,41,.5)']
                    , area: ['160px']
                });
            }, function () {
                layer.close(img_show);
            });
            $('td img').attr('style', 'max-width:70px');
        }

    });
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="people">查看详情</a>
</script>
<script type="text/html" id="imgTpl">
    <img src="{{ d.teamBadge}}"/>
</script>
</body>
</html>