<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="common/header::copy"><meta charset="UTF-8">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div th:replace="common/top::copy"></div>
    <div th:replace="common/left::copy (title = 'game', portion = 'newdakayem')"></div>
    <div class="layui-body">
        <!--内容主体-->
        <div style="padding: 15px;">
        <span class="layui-breadcrumb">
                <a href="/">CMS后台</a>
                <a href="/demo/">游戏管理</a>
                <a><cite>打卡管理</cite></a>-
        </span>
            <hr class="layui-bg-orange">
            <div style="padding: 20px; background-color: #F2F2F2;">
                <div class="layui-row layui-col-space15">
                    <div class="layui-col-md12">
                        <div class="layui-card-body">

                            <!-- 卡点表单提交 -->
                            <form class="layui-form layui-form-pane" onsubmit="return false;" id="form_submit">
                                <!-- UUID -->

                                <div class="layui-form-item">
                                    <a href="http://www.gpsspg.com/maps.htm" class="layui-btn" target="_blank">获取经纬度</a>
                                </div>
                                <!--<button type="button" onclick="selectRole()" class="layui-btn layui-btn-danger layui-btn-sm">获取经纬度</button>-->


                                <div class="layui-form-item">
                                    <label class="layui-form-label">UUID</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="cUuid" autocomplete="off" placeholder="点击自动生成"
                                               class="layui-input" id="click_inpu">
                                    </div>
                                </div>
                                <div class="layui-form-item" id="address">
                                    <label class="layui-form-label">打卡地址</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="cAddress" autocomplete="off" placeholder="请输入打卡地址"
                                               class="layui-input"><!--name="cAddress"-->
                                    </div>
                                </div>
                                <div class="layui-form-item" id="task">
                                    <label class="layui-form-label">打卡序号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="cTask" autocomplete="off" placeholder="请输入打卡序号"
                                               class="layui-input">  <!--name="cTask">-->
                                    </div>
                                </div>
                                <div class="layui-form-item" id="parent">
                                    <label class="layui-form-label">时间</label>
                                    <div class="layui-input-block" lay-verify="required|phone" placeholder="yyyy-MM-dd">
                                        <input type="date" class="layui-input" id="test1" name="activitytime">
                                    </div>
                                </div>
                                <div class="layui-form-item" id="goods">
                                    <!--<label class="layui-form-label">备注</label>-->
                                    <!--<div class="layui-input-block">
                                        <input type="text" name="cGoods" autocomplete="off" placeholder="请输入备注"
                                               class="layui-input" height="200px" width="200px">&lt;!&ndash;name="cGoods">&ndash;&gt;
                                    </div>-->
                                    备注：<br>
                                    <textarea rows="10" cols="100">


                                    </textarea>
                                </div>
                                <div class="layui-form-item" id="jing">
                                    <label class="layui-form-label">经度</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="cJingX" autocomplete="off" placeholder="请输入经度"
                                               class="layui-input" lay-verify="validateMoney">
                                    </div>
                                </div>
                                <div class="layui-form-item" id="wei">
                                    <label class="layui-form-label">纬度</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="cWeiY" autocomplete="off" placeholder="请输入纬度"
                                               class="layui-input" lay-verify="validateMoney">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <input type="hidden" name="cardUrl">
                                    <div class="layui-inline" style="margin-left: 50%;">
                                        <button type="reset" class="layui-btn" id="cardSubmit" >编辑</button>
                                        <button type="reset" class="layui-btn layui-btn-primary">保存</button>
                                        <!--<button type="reset" class="layui-btn layui-btn-primary">另存为</button>-->
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="common/footer::copy"></div>
</div>
<script th:replace="common/script::copy"></script>
<script type="text/javascript" th:inline="none" >


    layui.use(['form', 'layedit', 'upload', 'laydate'], function() {
        let form = layui.form
            , layer = layui.layer
            , laydate = layui.laydate
            , $ = layui.jquery
            , upload = layui.upload;

        // 自动生成UUID
        $("#click_inpu").click(function () {
            var a = Math.random().toString(36).substr(2, 15);
            var t = new Date().getTime();
            $("#click_inpu").val(a + t); // 24位
        })

        //点击按钮触发的点击事件
        $("#cardSubmit").click(function () {
            let cUuid = $("input[name='cUuid']").val();
            let cAddress = $("input[name='cAddress']").val();
            let cTask = $("input[name='cTask']").val();
            //let cardIfShow = $("input[name='cardIfShow']").val() == 'on' ? 1 : 0;
            let cParent = $("input[name='cParent']").val();
            let cGoods = $("input[name='cGoods']").val();
            let cJingX = $("input[name='cJingX']").val();
            let cWeiY = $("input[name='cWeiY']").val();
            let cIntegral = $("input[name='cIntegral']").val();
            let cErrors = $("input[name='cErrors']").val();
            if(cUuid == "" || cAddress == "" || cTask == "" || cParent == "" || cGoods == "" || cJingX == "" || cWeiY == "" || cIntegral == "" || cErrors == ""){
                layer.msg('请检查是否填完！', {
                    icon: 1,
                    time: 2000
                });
                return false;
            }

            /*let date_cards={
                cUuid:cUuid,
                cAddress: cAddress
            }*/

            let date_card = {
                cUuid:cUuid,
                cAddress: cAddress,
                cTask: cTask,
                cParent: cParent,
                cGoods: cGoods,
                cJingX: cJingX,
                cWeiY: cWeiY,
                cErrors:cErrors,
                cIntegral: cIntegral
            }
            var index_load = layer.load(1, {//加载   防止用户二次点击
                offset: '220px',
            });
            //生成打点信息
            $.post(context + '/cards/insertCards',date_card, function (res) {
                if (res == 100) {//res是一个封装状态码和实体类的一个类
                    layer.msg("生成打点信息成功！", {
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        layer.close(index_load);
                        return false;
                    });
                } else {
                    layer.msg("生成打点信息失败！", {
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    }, function () {
                        layer.close(index_load);
                        return false;
                    });
                }
            })

            /*/!*生成二维码*!/
            $.get(context + '/cards/get_qr/'+cUuid+'/'+cAddress,date_cards, function (res) {
                if(res.code==100){
                    layer.msg("生成二维码成功",{
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）

                    },function () {
                        layer.close();
                        return false;
                    });
                }else{
                    layer.msg("生成二维码失败",{
                        icon: 1,
                        time: 2000 //2秒关闭（如果不配置，默认是3秒）
                    },function () {
                        layer.close();
                        return false;
                    });
                }
            })*/
        })
    })
</script>
<script>
    function selectRole() {
        var  url=window.location.href;
        var world = url.split('=');
        var url_e = world[1];

        window.open(context+"/cards/newbaidumap", "_self");
    }
</script>

</body>
</html>