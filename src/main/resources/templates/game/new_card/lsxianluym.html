<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="common/header::copy"></head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div th:replace="common/top::copy"></div>
    <div th:replace="common/left::copy (title = 'game', portion = 'lsxianluym')"></div>
    <div class="layui-body">
        <!-- 内容主体区域 -->
        <div style="padding: 15px;">
            <span class="layui-breadcrumb">
                <a href="/weCharGameCms/work/index">CMS后台</a>
                <a href="/weCharGameCms/game/gameMap">游戏管理</a>
                <a><cite>历史卡点</cite></a>
            </span>
            <hr class="layui-bg-orange">
            <div style="padding: 20px; background-color: #F2F2F2;">
                <div class="layui-row layui-col-space15">
                    <div class="layui-col-md12">
                        <div class="layui-card">
                            <div class="layui-card-header">
                                <form class="layui-form" onsubmit="return false;">
                                    <div class="layui-form-item">
                                        <div class="layui-inline">
                                            <div class="layui-input-block">
                                                <!--<select name="cardGameId" lay-filter="aihao">
                                                    <option value="">选择游戏</option>
                                                    <option th:each="game : ${games}" th:value="${game.gameId}" th:text="${game.gameName}">写作</option>
                                                </select>-->
                                            </div>
                                        </div>
                                        <!--<div class="layui-inline">
                                            <button class="layui-btn" lay-submit="" lay-filter="submit_btn">搜索</button>
                                        </div>-->
                                    </div>
                                </form>
                            </div>
                            <div class="layui-card-body">
                                <table class="layui-hide" id="test" lay-filter="demo"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="common/footer::copy"></div>
</div>
<script type="text/html" id="switchTpl">
    <input type="checkbox" value="{{d.cId}}" lay-skin="switch" lay-text="已添加|添加"
           lay-filter="sexDemo" {{ d.cState== 1 ? 'checked' : '' }} />
</script>
<script type="text/html" id="imgTpl">
    <img src="{{ d.cUrl}}"/>
</script>
<!--<script type="text/html" id="1imgTpl">
    <img src="{{ d.cAddress}}"/>
</script>-->
<script th:replace="common/script::copy"></script>
<script type="text/javascript" th:inline="javascript">
    layui.use(['form', 'layedit', 'upload', 'laydate', 'table'], function() {
        var form = layui.form
            , layer = layui.layer
            , laydate = layui.laydate
            , $ = layui.jquery
            , upload = layui.upload;
        var table = layui.table;

        table.render({
            elem: '#test'
            ,url: context+'/select/selectall'
            ,cols: [[
                {field:'cUuid', width: '15%', title: '卡点ID', sort: true, align:'center'}
                ,{field:'cAddress', width: '15%', title:'打卡地址', align:'center'}
                ,{field:'cJingX', width: '15%', title:'经度', align:'center'}
                ,{field:'cWeiY', width: '15%', title: '纬度', sort: true, align:'center'}
                ,{field:'cUrl', width: '15%', title: '打卡二维码', align: 'center',templet: '#imgTpl', event: 'browse'}
                ,{field:'cParent', width: '15%', title:'前置条件', align:'center'}
                ,{
                    field: 'cState',
                    title: '添加',
                    name: "sysData",
                    templet: '#switchTpl',
                    unresize: true
                }//
            ]]
            ,page: true
            ,limit: 10
        });

        form.on('switch(sexDemo)', function (obj) {
            if (obj.elem.checked == true) {
                var x = obj.elem.checked;

                $.post(context + "/cardsCircuitList/insertCardsCircuitList", {"cdid": this.value ,
                    "cstatus": 1 }, function (res) {
                    console.log(res);
                    if (res.code==100) {
                        form.render();
                        layer.alert("添加成功");
                    } else {
                        obj.elem.checked = !x;
                        layer.alert("添加失败");
                    }
                })
            } else {
                console.log(this.value);
                $.post(context + "/select/deleteFroDate", {
                    "cxid": this.value ,"cdid": this.value,"cstatus": 0 }, function (res) {
                    if (res.code==100) {
                        layer.alert("取消成功");
                    }else{

                        layer.alert("取消失败");
                    }
                })
            }
        });
    })
</script>
</body>
</html>